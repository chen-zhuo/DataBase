# DQL语言：条件查询

### 语法特点

```sql
/*
语法：
SELECT
	查询列表
FROM
	表名
WHERE
	筛选条件;

筛选条件分类：
一、按条件表达式筛选
简单条件运算符：> < = != <> >= <=
二、按逻辑表达式筛选
逻辑运算符：&& || ! and or not
三、模糊查询
关键字：LIKE、BETWEEN AND、IN、IS NULL、\
*/
```

### 条件表达式筛选

数据库表一般包含大量的数据，很少需要检索表中所有行。通常只需要提取表数据的子集，检索所需数据需要指定搜索条件（search criteria），搜索条件也称为过滤条件（filter condition）。

##### 条件表达式含义

|    操作符    |   说明   |
| :----------: | :------: |
|     `=`      |   等于   |
| `<>` 或 `!=` |  不等于  |
|     `<`      |   小于   |
|     `<=`     | 小于等于 |
|     `>`      |   大于   |
|     `>=`     | 大于等于 |

##### 使用条件表达式

使用条件表达式筛选时，若字段类型为int时，比较值不加引号 `''`；若字段类型为str时，比较值要加引号 `''`；

```sql
-- 查询工资大于12000的员工信息
SELECT
	*
FROM
	employees
WHERE
	salary > 12000;
```

![QQ截图20201125230350](image/QQ截图20201125230350.png)

在SQL语句中不等于有两种写法：`<>` 、`!=`，他们的作用都是一样的。

```sql
-- 查询部门编号不等于90号的员工名和部门编号
SELECT
	last_name,
	department_id
FROM
	employees
WHERE
	department_id <> 90;
```

![QQ截图20201125231001](image/QQ截图20201125231001.png)

### 逻辑表达式筛选

##### 逻辑表达式含义

```
&&或and：两个条件都为true，结果为true，反之为false
||或or：只要有一个条件为true，结果为true，反之为false
!或not：如果连接的条件本身为false，结果为true，反之为false
```

##### 使用逻辑表达式

使用逻辑表达式筛选时，每添加一条件语句就要增加使用一个逻辑表达式。

```sql
-- 查询工资在10000到20000之间的员工名、工资以及奖金
SELECT
	last_name,
	salary,
	commission_pct
FROM
	employees
WHERE
	salary >= 10000
AND 
	salary <= 20000;
```

![QQ截图20201125232047](image/QQ截图20201125232047.png)

**在SQL语句中 `AND` 的执行次序要高于 `OR` 。**

**在条件句外侧加`()`，可以提高执行次序。**

```sql
-- 查询部门编号不在90到110之间或者工资高于15000的员工信息
-- 写法一
SELECT
	*
FROM
	employees
WHERE
	department_id < 90
OR 
	department_id > 110
OR 
	salary > 15000;

-- 写法二
SELECT
	*
FROM
	employees
WHERE
NOT(
	department_id >= 90
AND
	department_id <= 110
)
OR 
	salary > 15000;
```

![QQ截图20201125232747](image/QQ截图20201125232747.png)

### 模糊查询

前面介绍的所有操作符都是针对已知值进行过滤的。但是，这种过滤方法并不是任何时候都好用。例如，怎样搜索字符串中包含'jet'的所有字符串？用简单的比较操作符肯定不行，必须使用通配符。

##### 模糊查询组成

`LIKE`：**模糊查询关键字，后面跟搜索条件。**

通配符(wildcard)：**结合 `LIKE` 操作符来匹配值的一部分的特殊字符**。

搜索模式(search pattern)：**由字面值、通配符或两者组合构成的搜索条件。**

##### 百分号`%`通配符

百分号`%`：**匹配出现任意次数的任意字符（包含0个字符，但NULL除外）。**

```sql
-- 检索任意以jet起头的字符串，不管后面是什么字符和有多少字符
SELECT * FROM 表名 WHERE 字段名 LIKE 'jet%';

-- 检索任意位置包含jet的字符串，而不论它之前或之后出现什么字符。
SELECT * FROM 表名 WHERE 字段名 LIKE '%jet%';

-- 检索以j起头，以t结尾的字符串，而不论中间出现什么字符。
SELECT * FROM 表名 WHERE 字段名 LIKE 'j%t';
```

!> 字符串尾空格可能会干扰通配符匹配，检索时最好在最后附加一个百分号(%)。

##### 下划线`_`通配符

下划线`_`：**匹配出现任意的单个字符。**

```sql
-- 检索任意以jet起头，长度为4的所有行
SELECT * FROM 表名 WHERE 字段名 LIKE 'jet_';

-- 检索任意以jet结尾，长度为4的所有行
SELECT * FROM 表名 WHERE 字段名 LIKE '_jet';

-- 检索第一个、最后一个字符为任意字符，中间字符为jet，长度为5的所有行
SELECT * FROM 表名 WHERE 字段名 LIKE '_jet_';
```

!> 下划线 `_` 必须要匹配到一个字符，不能多也不能少。

##### 反斜杠`\`转义符

反斜杠`\`：将带有特殊功能的字符转义为普通字符。

```sql
-- 检索字段名中第二个字符为_，第五个字符为%，长度为5的所有信息
SELECT * FROM 表名 WHERE 字段名 LIKE '_\___\%';

-- 自定义转义字符（将$定义为转义字符）
SELECT * FROM 表名 WHERE 字段名 LIKE '_$___$%' ESCAPE '$';
```

##### `BETWEEN AND`

`BETWEEN` 的后面跟2个临界值，临界值之间必须用 `AND` 符连接。

1. 使用 `BETWEEN AND` 可以提高语句简介度。
2. 筛选结果包含两边的临界值。
3. 两个临界值不要调换顺序。

```sql
-- 查询员工编号在100到120之间的员工信息
SELECT
	*
FROM
	employees
WHERE
	employee_id BETWEEN 100 AND 120;
```

![QQ截图20201126000505](image/QQ截图20201126000505.png)



### 限制

返回结果前m行数据：`SELECT 字段名称 FROM 通用认证信息 LIMIT m;`

返回结果第m行后n行数据：`SELECT 字段名称 FROM 通用认证信息 LIMIT m,n;`

```sql
SELECT id, 公司名称 FROM 通用认证信息 LIMIT 1;
/*
返回结果第1行数据（包括第1行）
+----+--------------+
| id | 公司名称     |
+----+--------------+
|  1 | 小白公司     |
+----+--------------+
1 row in set (0.00 sec)
*/

SELECT id, 公司名称 FROM 通用认证信息 LIMIT 1,2;
/*
# 返回结果第1行的后2行数据（不包括第1行）
+----+--------------+
| id | 公司名称     |
+----+--------------+
|  2 | 小明公司     |
|  3 | 小红公司     |
+----+--------------+
2 rows in set (0.00 sec)
*/
```

### 排序

##### 单列排序

升序检索：`SELECT 字段名称 FROM 表名 ORDER BY 字段名称;`

降序检索：`SELECT 字段名称 FROM 表名 ORDER BY 字段名称 DESC;`

!> 注意：**检索数据时，若没有排序，其结果是没有特定顺序的。**

!> 注意：**检索数据时，排序的字段可以是表中存在的任意字段。**

```sql
SELECT id, 公司名称 FROM 通用认证信息 ORDER BY id;
/*
# 以'id'字段升序，输出'id', '公司名称'字段。
+----+--------------+
| id | 公司名称     |
+----+--------------+
|  1 | 小白公司     |
|  2 | 小明公司     |
|  3 | 小红公司     |
+----+--------------+
3 rows in set (0.00 sec)
*/

SELECT id, 公司名称 FROM 通用认证信息 ORDER BY id DESC;
/*
# 以'id'字段降序，输出'id', '公司名称'字段。
+----+--------------+
| id | 公司名称     |
+----+--------------+
|  3 | 小红公司     |
|  2 | 小明公司     |
|  1 | 小白公司     |
+----+--------------+
3 rows in set (0.00 sec)
*/

SELECT id, 公司名称 FROM 通用认证信息 ORDER BY 证书状态 DESC;
/*
# 以'证书状态'字段降序，输出'id', '公司名称'字段。
+----+--------------+
| id | 公司名称     |
+----+--------------+
|  2 | 小明公司     |
|  3 | 小红公司     |
|  1 | 小白公司     |
+----+--------------+
3 rows in set (0.00 sec)
*/
```

##### 多列排序

先字段1升序，后字段2升序检索：`SELECT 字段名称 FROM 表名 ORDER BY 字段1, 字段2;`

先字段2升序，后字段1升序检索：`SELECT 字段名称 FROM 表名 ORDER BY 字段2, 字段1;`

先字段1升序，后字段2降序检索：`SELECT 字段名称 FROM 表名 ORDER BY 字段1, 字段2 DESC;`

先字段1降序，后字段2降序检索：`SELECT 字段名称 FROM 表名 ORDER BY 字段1 DESC, 字段2 DESC;`

!> 注意：**如果想在多个列上进行降序排序，必须对每个列指定DESC关键字。**

!> 注意：**与DESC相反的关键字是ASC（ASCENDING），实际ASC没有多大用处，因为升序是默认的（如果既不指定ASC也不指定DESC，则假定为ASC）。**

```sql
SELECT 公司名称,证书状态 FROM 通用认证信息 ORDER BY 公司名称,证书状态;
/*
# 以'公司名称'升序，再以'证书状态'升序，输出'公司名称','证书状态'字段
+--------------+--------------+
| 公司名称     | 证书状态     |
+--------------+--------------+
| 小明公司     | 过期         |
| 小白公司     | 有效         |
| 小红公司     | 过期         |
+--------------+--------------+
3 rows in set (0.00 sec)
*/

SELECT 公司名称,证书状态 FROM 通用认证信息 ORDER BY 证书状态,公司名称;
/*
# 以'证书状态'升序，再以'公司名称'升序，输出'公司名称','证书状态'字段
+--------------+--------------+
| 公司名称     | 证书状态     |
+--------------+--------------+
| 小白公司     | 有效         |
| 小明公司     | 过期         |
| 小红公司     | 过期         |
+--------------+--------------+
3 rows in set (0.00 sec)
*/

SELECT 公司名称,证书状态 FROM 通用认证信息 ORDER BY 证书状态,公司名称 DESC;
/*
# 以'证书状态'升序，再以'公司名称'降序，输出'公司名称','证书状态'字段
+--------------+--------------+
| 公司名称     | 证书状态     |
+--------------+--------------+
| 小白公司     | 有效         |
| 小红公司     | 过期         |
| 小明公司     | 过期         |
+--------------+--------------+
3 rows in set (0.00 sec)
*/
```

##### 排序限制

结合排序和限制：`SELECT 字段1, 字段2... FROM 表名 ORDER BY 字段名称 LIMIT 返回数量;`

```sql
SELECT 公司名称,证书状态 FROM 通用认证信息 ORDER BY id LIMIT 2;
/*
# 以id升序检索，输出'公司名称','证书状态'字段结果的前2条
+--------------+--------------+
| 公司名称     | 证书状态     |
+--------------+--------------+
| 小白公司     | 有效         |
| 小明公司     | 过期         |
+--------------+--------------+
2 rows in set (0.00 sec)
*/
```

