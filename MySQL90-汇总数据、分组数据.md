# 数据汇总、数据分组

### 数据分组

分组允许把数据分为多个逻辑组，以便能对每个组进行聚集计算。

##### 创建分组

**分组是在SELECT语句的GROUP BY子句中建立的。**

```sql
-- 以相同的字段值进行分组，在'COUNT_字段'返回统计出现的次数
SELECT 字段, COUNT(*) AS COUNT_字段 FROM 表名 GROUP BY 字段;
```

!> `GROUP BY` 子句中列出的每个列都必须是检索列或有效的表达式（但不能是聚集函数）。

!> 除聚集计算语句外，`SELECT` 语句中的每个列都必须在 `GROUP BY` 子句中给出。

!> 在 `SELECT` 中使用表达式，则必须在 `GROUP BY` 子句中指定相同的表达式，并且不能使用别名。

!> `GROUP BY` 子句必须出现在 `WHERE` 子句之后，`ORDER BY` 子句之前。

!> 如果分组列中具有 `NULL` 值，则 `NULL` 将作为一个分组返回。如果列中有多行 `NULL` 值，它们将分为一组。

##### 过滤分组

MySQL提供了 `HAVING` 子句。`HAVING` 非常类似于 `WHERE`。**唯一的差别是 `WHERE` 过滤行，而 `HAVING` 过滤分组。**

?> `HAVING` 支持所有 `WHERE` 操作符，所学过的有关 `WHERE` 的所有这些技术和选项都适用于 `HAVING` 。它们的句法是相同的，只是关键字有差别。

```sql
-- 以相同的字段值进行分组，在'COUNT_字段'返回统计出现的次数，筛选出出现次数大于等于3的字段
SELECT 字段, COUNT(*) AS COUNT_字段 FROM 表名 GROUP BY 字段 HAVING COUNT(*) >= 3; 
```

##### 分组和排序

虽然 `GROUP BY` 和 `ORDER BY` 经常完成相同的工作，但它们是非常不同的。

|             `ORDER BY`             |                       `GROUP BY`                       |
| :--------------------------------: | :----------------------------------------------------: |
|                排序                |                          分组                          |
| 任意列（包括非选择的列）都可以使用 | 只能使用选择列或表达式列，而且必须使用每个选择列表达式 |
|             不一定需要             |       与聚集函数一起使用列（或表达式），必须使用       |

##### SELECT子句顺序

回顾一下SELECT语句中子句的顺序：

|   子 句    |       说 明        |        必须使用        |
| :--------: | :----------------: | :--------------------: |
|  `SELECT`  | 要返回的列或表达式 |           是           |
|   `FROM`   |  从中检索数据的表  | 仅在从表选择数据时使用 |
|  `WHERE`   |      行级过滤      |           否           |
| `GROUP BY` |      分组说明      | 仅在按组计算聚集时使用 |
|  `HAVING`  |      组级过滤      |           否           |
| `ORDER BY` |    输出排序顺序    |           否           |
|  `LIMIT`   |    要检索的行数    |           否           |

