# MySQL数据库

### 简介

SQL(Structured Query Language)结构化查询语言的缩写，是一种数据库查询和程序设计语言。

SQL语言用于存储数据以及查询、更新和管理关系型数据库系统。

SQL也是数据库脚本文件的扩展名，例如test.sql文件。

##### SQL语言组成

SQL语言主要由五类语言组成

数据定义语言(DDL)，例如：CREATE、DROP、ALTER等语句。

数据操作语言(DML)，例如：INSERT、UPDATE、DELETE。

数据查询语言(DQL)，例如：SELECT语句。

数据控制语言(DCL)，例如：GRANT、REVOKE。

数据事务语言(DTL)，例如：BEGIN、COMMIT、ROLLBACK等语句

##### SQL的执行顺序

–第一步：执行FROM

–第二步：WHERE条件过滤

–第三步：GROUP BY分组

–第四步：执行SELECT投影列

–第五步：HAVING条件过滤

–第六步：执行ORDER BY 排序



### 数据类型

##### 整型

| **数据类型** | **所占字节** | **取值范围**           |
| ------------ | ------------ | ---------------------- |
| tinyint      | 1字节        | -128~127               |
| smallint     | 2字节        | -32768~32767           |
| mediumint    | 3字节        | -8388608~8388607       |
| int          | 4字节        | -2147483648~2147483647 |
| bigint       | 8字节        | +-9.22*10的18次方      |

##### 浮点型

| **数据类型**  | **所占字节** | **取值范围**                   |
| ------------- | ------------ | ------------------------------ |
| float(m, d)   | 4字节        | 单精度浮点型，m总个数，d小数位 |
| double(m, d)  | 8字节        | 双精度浮点型，m总个数，d小数位 |
| decimal(m, d) |              | decimal是存储为字符串的浮点数  |

浮点是非精确值，会存在不太准确的情况。

decimal叫做定点数，在MySQL内部本质上是用字符串存储的。实际使用过程中如果存在金额、钱精度要求比较高的浮点数存储，建议使用decimal类型。

##### 字符型

| **数据类型** | **所占字节**        | **取值范围**                       |
| ------------ | ------------------- | ---------------------------------- |
| char         | 0-255字节           | 定长字符串                         |
| varchar      | 0-65535字节         | 变长字符串                         |
| tinyblob     | 0-255字节           | 不超过255个字符的二进制字符串      |
| tinytext     | 0-255字节           | 短文本字符串                       |
| blob         | 0-65535字节         | 二进制形式的长文本数据             |
| text         | 0-65535字节         | 长文本数据                         |
| mediumblob   | 0-16 777 215字节    | 二进制形式的中等长度文本数据       |
| mediumtext   | 0-16 777 215字节    | 中等长度文本数据                   |
| longblob     | 0-4 294 967 295字节 | 二进制形式的极大文本数据           |
| longtext     | 0-4 294 967 295字节 | 极大文本数据                       |
| varbinary(M) | 允许长度0-M个字节   | 不定长字节字符串，值的长度+1个字节 |
| binary(M)    | M                   | 允许长度0-M个字节的定长字节字符串  |

char类型用于定长字符串，并且必须在圆括号内用一个大小修饰符来定义。这个大小修饰符的范围从 0-255。比指定长度大的值将被截短，而比指定长度小的值将会用空格作填补。

varchar把这个大小视为值的大小，长度不足的情况下不用空格补足，只使用存储字符串实际需要的长度，但长于指定的值仍然会被截短。

blob类型区分大小写，text不区分大小写。

binary声音文件等二进制数据类型。

##### 时间类型

| **数据类型** | **所占字节** | **取值范围**                                |
| ------------ | ------------ | ------------------------------------------- |
| date         | 4字节        | 日期，格式：2014-09-18                      |
| time         | 3字节        | 时间，格式：08:42:30                        |
| datetime     | 8字节        | 日期时间，格式：2014-09-18 08:42:30         |
| timestamp    | 4字节        | 自动存储记录修改的时间（current_timestamp） |
| year         | 1字节        | 年份1901~2155                               |

##### 复合类型

| **数据类型** | **所占字节** | **取值范围**                  |
| ------------ | ------------ | ----------------------------- |
| set          | 集合类型     | set(“m1”, “m2″, … ,“m63″)     |
| enum         | 枚举类型     | enum(“m1″, “m2″, … ,“m65535″) |

**set**

“位”是创建有序元素集合的一种简单而有效的方式。在 SET 元素中值被存储为一个分离的“位”序列，这些“位”表示与它相对应的元素。

SET类型可以从预定义的集合中取得任意数量的值。

**一个 SET 类型最多可以包含 64 项元素，并且它还去除了重复的元素，所以SET类型中不可能包含两个相同的元素。**

任何试图在 SET 类型字段中插入非预定义的值都会使MySQL插入一个空字符串。如果插入一个即有合法的元素又有非法的元素的记录，MySQL 只会保留合法的元素，除去非法的元素。若需从 SET 类型字段中找出非法的记录只需查找包含空字符串或二进制值为 0 的行。

**ENUM**

ENUM 类型在系统内部可以存储为数字，并且从1开始用数字做索引。

ENUM 类型因为只允许在集合中取得一个值，类似于单选项，即相互排拆的数据，比如性别。

**一个 ENUM 类型最多可以包含 65536 个元素，其中一个元素被 MySQL 保留，用来存储错误信息，这个错误值用索引 0 或者一个空字符串表示。**

ENUM 类型字段可以从集合中取得一个值或使用null值，除此之外的输入将会使 MySQL 在这个字段中插入一个空字符串。MySQL 认为 ENUM 类型集合中出现的值是合法输入，除此之外其它任何输入都将失败。这说明通过搜索包含空字符串或对应数字索引为 0 的行就可以很容易地找到错误记录的位置。

ENUM 类型字段插入值的大小写与集合中值的大小写不匹配，MySQL会自动使用插入值的大小写转换成与集合中大小写一致的值。

##### 其他属性

**UNSIGNED**

**UNSIGNED（无符号） 即没有前面面的负号，所有的数都为正数，主要用于整型和浮点类型。**

无符号存储位数更长，tinyint整型的取值区间为-128~127，而使用无符号后可存储0-255个长度。

创建时在整型或浮点型字段语句后接上unsigned。

**auto_increment**

**auto_increment（自增）即自动增加，只用于整型，可以设置起始值，默认为1，常用于id。**

常与primary key（主键）一起使用，创建表时加上：auto_increment=起始值 primary key

修改起始值：alter table user auto_increment=起始值

**default**

**default（默认值）确保在没有任何值可用的情况下，赋予某个常量值，这个值必须是常量，因为MySQL不允许插入函数或表达式值。**

default无法用于BLOB或TEXT列，如果已经为此列指定了NULL属性，没有指定默认值时默认值将为NULL。

创建表时在字段语句后接上：default '值'

**null**

null为列指定null属性时，该列可以保持为空，而不论行中其它列是否已经被填充。

记住，null精确说法是“无”，而不是空字符串或0。

**not null**

一个列定义为not null（不能为空），将不允许向该列插入null值。

建议在重要情况下始终使用not null属性，因为它提供了一个基本验证，确保已经向查询传递了所有必要的值。

创建时在字段语句后接上：not null

**ZEROFILL(0填充-了解)**

 0（不是空格）可以用来增补输出的值。使用这个修饰符可以阻止 MySQL 数据库存储负值。

创建时在整型字段语句后接上：zerofill

### MySQL操作

##### 启动ＭySQL

打开命令窗口（管理员模式），输入（net start mysql），启动mysql服务。

##### 进入MySQL

**连接服务器的MySQL**

mysql  -h  服务器地址  -u  用户名  -p（回车）

Enter Password:（输入密码）

mysql>（进入成功）

**连接本机的MySQL**

mysql   -u  root  -p（回车）

Enter Password:（输入密码）

mysql>（进入成功）

### 用户管理

**注意：用户管理全部在MySQL里面执行。**

##### 创建用户

**注意：新建用户没有任何权限。**

| **类型** | **说明**                                                 |
| -------- | -------------------------------------------------------- |
| 基本语法 | Create user ‘用户名’@‘用户地址’ identified by ‘密码’;    |
| 示例     | Create user 'test'@'192.168.10.1' identified by '12345'; |
| 示例说明 | 创建用户，并且设置密码                                   |

**说明：用户地址为"localhost"，是指该用户只能在本地登录，不能在另外一台机器上远程登录。如果想远程登录的话，将用户地址改为"%"，表示在任何一台电脑上都可以登录。也可以指定某台机器可以远程登录。**

##### 授予权限

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | grant 权限 on 数据库.表名 to ‘用户名’@‘用户地址’;            |
| 示例     | grant select, insert on test.user  to 'test'@'192.168.10.1'; |
| 示例说明 | 给用户test数据库user表的查询、插入权限                       |
| 示例     | grant all on \*.* to 'test'@'192.168.10.1';                  |
| 示例说明 | 给用户test所有数据库的所有权限                               |

##### 剥夺权限

| **类型** | **说明**                                            |
| -------- | --------------------------------------------------- |
| 基本语法 | revoke all on 数据库.表名 from ‘用户名’@‘用户地址’; |
| 示例     | revoke all on \*.* from 'test'@'192.168.10.1';      |
| 示例说明 | 收回用户所有数据库的权限                            |

##### 删除用户

| **类型** | **说明**                         |
| -------- | -------------------------------- |
| 基本语法 | drop user ‘用户名’@‘用户地址’;   |
| 示例     | drop user 'test'@'192.168.10.1'; |
| 示例说明 | 删除用户                         |

### 数据库操作

##### 查看数据库

| 分类     | 详解                       |
| -------- | -------------------------- |
| 基本语法 | show databases;            |
| 示例说明 | 显示当前服务器的所有数据库 |

##### 创建数据库

| 分类     | 详解                             |
| -------- | -------------------------------- |
| 基本语法 | create database 数据库名;        |
| 示例     | create database test;            |
| 示例说明 | 创建一个数库，数据库的名字为test |

##### 选中数据库

| 分类     | 详解           |
| -------- | -------------- |
| 基本语法 | use 库名;      |
| 示例     | use test;      |
| 示例说明 | 使用数据库test |

##### 删除数据库

| 分类     | 详解                               |
| -------- | ---------------------------------- |
| 基本语法 | drop database 库名;                |
| 示例     | drop database test;                |
| 示例说明 | 删除一个数据库，数据库的名字为test |

### 数据表操作

**注意：操作数据表的前提是要先选中数据库。**

##### 查看表

| 分类     | 详解                     |
| -------- | ------------------------ |
| 基本语法 | show tables;             |
| 示例说明 | 显示当前数据库下所有的表 |

##### 查看表结构

| **分类** | **详解**           |
| -------- | ------------------ |
| 基本语法 | desc 表名;         |
| 示例     | desc user;         |
| 示例说明 | 查看user表的表结构 |

##### 创建表

| **分类** | **详解**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | create table 表名(字段名1 字段类型,....字段名n 字段类型n);   |
| 示例     | create table user(username varchar(20),password char(32));   |
| 示例说明 | 创建一个表名叫user的表，第一个字段为username、表的字段类型为varchar长度为20个长度。第二个字段为password，类型为char，长度也为32个长度。 |

##### 修改表名称

| **分类** | **详解**                            |
| -------- | ----------------------------------- |
| 基本语法 | alter table 旧表名 rename 新的表名; |
| 示例     | alter table user rename new_user;   |
| 示例说明 | 将user表名改为new_user              |

##### 删除表

| **分类** | **详解**         |
| -------- | ---------------- |
| 基本语法 | drop table 表名; |
| 示例     | drop table user; |
| 示例说明 | 删除表user       |

##### 指定属性

创建表时指定需要每次指定
存储引擎 engine=InnoDB
指定字符集default charset=utf8

例子：create table user(
					id int auto_increment,
​					name varchar(50) not null,
​					money float not null , 
​					province varchar(20) default null , 
​					age tinyint  unsigned not null , 
​					sex tinyint not null , 
​					primary key (id)
​					) engine= InnoDB default charset=utf8;

​			创建表user（

​					id字段（int，自增类型）

​					name字段（字符串（最大长度50），不能为空（必须有值））

​					money字段（float，不能为空）

​					province字段（字符串（最大长度20），默认为空（可以无值））

​					age字段（int，无符号（没有负号即为正数），不能为空）

​					sex字段（int，不能为空）

​					主键索引id

​					）存储引擎 engine=InnoDB，创建表时指定字符集default charset=utf8

### 字段操作

**注意：字段就是数据表中一列数据的名称，操作时不用选中表。**

##### 增加字段

| **分类** | **详解**                          |
| -------- | --------------------------------- |
| 基本语法 | alter table 表名 add 字段名 类型; |
| 示例     | alter table user add age int;     |
| 示例说明 | 添加一个字段为age，类型为整型     |

| **分类** | **详解**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | alter table 表名 add 字段名 字段类型 after 字段名;           |
| 示例     | alter table user add email varchar(60) after createip;       |
| 示例说明 | user表中，在createip后增加一个字段为email，类型为varchar，长度为60 |

| **分类** | **详解**                                                  |
| -------- | --------------------------------------------------------- |
| 基本语法 | alter table 表名 add 字段名 字段类型;                     |
| 示例     | alter table user add id int(10) first;                    |
| 示例说明 | user表中在最开始位置增加一个字段为id，类型为int，长度为10 |

##### 修改字段类型

| **分类** | **详解**                                      |
| -------- | --------------------------------------------- |
| 基本语法 | alter table 表名 modify 字段名 varchar(20);   |
| 示例     | alter table user modify username varchar(20); |
| 示例说明 | 将user表的username的类型改为varchar(20)       |

##### 修改字段名称

| **分类** | **详解**                                            |
| -------- | --------------------------------------------------- |
| 基本语法 | alter table 表名 change 字段原名 字段新名 字段类型; |
| 示例     | alter table user change email em varchar(60);       |
| 示例说明 | 在user表中将字段中的email字段名字为em               |

##### 删除字段

| **分类** | **详解**                      |
| -------- | ----------------------------- |
| 基本语法 | alter table 表名 drop 字段名; |
| 示例     | alter table user drop age;    |
| 示例说明 | 在user表中删除字段age         |

### 索引

**索引就是书刊最前面的目录，用于快速找出在某个列中有一特定值的行。**

表中查询的列有一个索引，MySQL能快速到达一个位置去搜寻到数据文件的中间，没有必要看所有数据。

**注意：索引也不要过多，因为写入修改数据时，也要修改索引，修改的速度变慢。**

##### 索引分类

| **索引类型** | **功能说明**                                                 |
| ------------ | ------------------------------------------------------------ |
| 普通索引     | 最基本的索引，它没有任何限制                                 |
| 唯一索引     | 某一行启用了唯一索引则不准许这一列的行数据中有重复的值。针对这一列的每一行数据都要求是唯一的 |
| 主键索引     | 它是一种特殊的唯一索引，不允许有空值。一般是在建表的时候同时创建主键索引，常用于用户ID。类似于书中的页码 |
| 全文索引     | 对于需要全局搜索的数据，进行全文索引                         |

##### 查看索引

| **索引类型** | **功能说明**               |
| ------------ | -------------------------- |
| 基本语法     | show index from tablename; |
| 示例         | show index from user;      |
| 示例解释     | 查看user表的索引结构       |

##### 普通索引

| **索引类型** | **功能说明**                           |
| ------------ | -------------------------------------- |
| 基本语法     | alter table 表 add index(字段)         |
| 示例         | alter table money add index(username); |
| 示例解释     | 为money表的username字段增加索引        |

##### 唯一索引

| **索引类型** | **功能说明**                         |
| ------------ | ------------------------------------ |
| 基本语法     | alter table 表 add unique(字段)      |
| 示例         | alter table money add unique(email); |
| 示例解释     | 为money表的email字段增加唯一索引     |

##### 主键索引

| **索引类型** | **功能说明**                           |
| ------------ | -------------------------------------- |
| 基本语法     | alter table 表 add primary key(字段)   |
| 示例         | alter table money add primary key(id); |
| 示例解释     | 为money表的id字段增加主键索引          |

##### 全文索引

| **索引类型** | **功能说明**                             |
| ------------ | ---------------------------------------- |
| 基本语法     | alter table 表 add fulltext(字段)        |
| 示例         | alter table money add fulltext(content); |
| 示例解释     | 为money表的content字段增加唯一索引       |

一般操作

创建表时可在创建表语句后加上对应的类型即可声明索引：

create table user (
		id int auto_increment,
		name varchar(20),
		primary key(id),
		unique (name)
								)engine=innodb default charset=utf8;

##### 删除索引

| **索引类型** | **功能说明**                         |
| ------------ | ------------------------------------ |
| 基本语法     | alter table 表名 drop index 索引字段 |
| 示例         | alter table money drop index age;    |
| 示例解释     | 为money表删除age索引                 |

### 数据操作

**注意：数据操作是操作数据表里面的数据，操作时不用选中表。**

##### 业务组成

**在真实的业务场景中，业务都为增、删、改、查组成。**

1. 注册是增加用户
2. 取钱是修改余额和增加记录
3. 帖子屏蔽可能是删除
4. 显示数据是查询

##### 查询全部数据

| **类别** | **详细解释**                     |
| -------- | -------------------------------- |
| 基本语法 | select * from 表;                |
| 示例     | select * from star;              |
| 示例说明 | 查询star表中所有字段中的所有结果 |

##### 查询指定字段数据

| **类别** | **详细解释**                        |
| -------- | ----------------------------------- |
| 基本语法 | select 字段 from 表;                |
| 示例     | select id, name, money from star;   |
| 示例说明 | 查询star表中id, username, money字段 |

##### 查询指定条件数据

where后可接的条件：

| **符号**    | **说明**            |
| ----------- | ------------------- |
| >           | 大于                |
| <           | 小于                |
| >=          | 大于等于            |
| <=          | 小于等于            |
| !=  或 <>   | 不等于              |
| =           | 等于                |
| or          | 或者                |
| and         | 并且                |
| between and | 在某个闭区间        |
| in / not in | 在/不在指定的集合中 |
| like        | 模糊查询            |

| **类型** | **说明**                                            |
| -------- | --------------------------------------------------- |
| 基本语法 | select 字段 from 表 where  条件;                    |
| 示例     | select * from star where age=43;                    |
| 说明     | 查询star表中age为43的所有结果                       |
| 示例     | select * from star where id<10 and province='湖北'; |
| 说明     | 查询star表中所有id小于10并且province为湖北          |
| 示例     | select * from star where id between 3 and 10;       |
| 说明     | 查询star表中所有id在[3, 10]的闭区间的记录           |
| 示例     | select * from star where id in(3,4,8,10);           |
| 说明     | 查询star表中所有id在指定集合中的记录                |

##### 查询不重复的数据

| **类别** | **详细解释**                         |
| -------- | ------------------------------------ |
| 基本语法 | select distinct 字段 from 表;        |
| 示例     | select distinct age, sex from star;  |
| 示例说明 | 查询star表中age和sex组合的不重复结果 |

##### 查询关键词

| **类型** | **说明**                       |
| -------- | ------------------------------ |
| select   | 选择的列                       |
| from     | 表                             |
| where    | 查询的条件                     |
| group by | 分组属性 having 分组过滤的条件 |
| order by | 排序属性                       |
| limit    | 起始记录位置，取记录的条数     |

##### 查询数据排序

| **关键词** | **说明**                   |
| ---------- | -------------------------- |
| asc        | 升序排列，从小到大（默认） |
| desc       | 降序排列，从大到小         |

| **类型** | **说明**                                                |
| -------- | ------------------------------------------------------- |
| 基本语法 | select 字段 from 表 order by 字段 排序关键词            |
| 示例     | select id, name, money from star order by money desc;   |
| 示例说明 | 查询star表中的id, name, money字段，按照余额进行降序排序 |

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | select 字段 from 表 order by 字段1 desc\|asc, ... ,字段n desc\|asc; |
| 示例     | select id, name, money from star order by money desc, age asc; |
| 示例说明 | 查询star表中的id, name, money字段，按照余额进行降序排序,若余额全都一样，则再使用age进行升序排序 |

##### 查询数据限制

对于查询或者排序后的结果集，如果希望只显示一部分，使用limit关键字对结果集进行数量限制。

| **类型** | **说明**                                  |
| -------- | ----------------------------------------- |
| 基本语法 | select 字段 from 表 limit 数量;           |
| 示例     | select id, name, money from star limit 5; |
| 示例说明 | 显示前5个记录                             |

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | select 字段 from 表 order by 字段 排序规则 limit 数量        |
| 示例     | select id, name, money from star order by money desc limit 5; |
| 示例说明 | 按照money来排序，显示前5个最有钱的记录                       |

| **类型** | **说明**                                    |
| -------- | ------------------------------------------- |
| 基本语法 | select 字段 from 表 limit 偏移量,数量       |
| 示例     | select id, name, money from star limit 0,3; |
| 示例说明 | 取从第一条开始的三条记录                    |

##### 查询数据统计

常用统计函数：

| **类型** | **说明** |
| -------- | -------- |
| sum      | 求和     |
| count    | 统计总数 |
| max      | 最大值   |
| min      | 最小值   |
| avg      | 平均值   |

| **类型** | **说明**                    |
| -------- | --------------------------- |
| 基本语法 | select 函数(字段) from 表   |
| 示例     | select count(id) from star; |
| 示例说明 | 查询star表的id总数          |

##### 查询数据分组

| **类型** | **说明**                              |
| -------- | ------------------------------------- |
| 基本语法 | select * from 表 group by 字段        |
| 示例     | select * from star group by province; |
| 示例说明 | 按照province进行分组                  |

| **类型** | **说明**                                               |
| -------- | ------------------------------------------------------ |
| 基本语法 | select * from 表 group by 字段                         |
| 示例     | select count(*), province from star group by province; |
| 示例说明 | 对分组进行单独统计                                     |

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | select * from 表 group by 字段 having 条件                   |
| 示例     | select count(province) as result , province from star group by province having result>2; |
| 示例说明 | 对province分组并统计总数，将分组结果中大于2的分组显示出来    |

##### 插入数据

插入数据可以不传值的情况：

1. 自增的字段可以不用传入值(每插入一条该字段的值会自动加1)
2. 有默认值的字段可以不传值
3. 可为空的字段可不传值

| **类别** | **详细解释**                                                 |
| -------- | ------------------------------------------------------------ |
| 基本语法 | insert into 表(字段1,字段2,字段n) values(值1,值2,值n);       |
| 示例     | insert into star(name, money, province, age, sex) values('郭德纲', 1000000, '天津', 43, 0); |
| 示例说明 | 向user表中插入值，姓名为郭德纲，余额为1000000，省份为天津，年龄为43，性别为0(男) |

| **类别** | **详细解释**                                                 |
| -------- | ------------------------------------------------------------ |
| 基本语法 | insert into 表 values(值1,值2,值n);                          |
| 示例     | insert into star values(1, '王宝强', 0, '河北' ,32, 0);      |
| 示例说明 | 向user表中插入值id为1，姓名为王宝强，余额为0，省份为河北，年龄为32，性别为0(男) |

| **类别** | **详细解释**                                                 |
| -------- | ------------------------------------------------------------ |
| 基本语法 | insert into 表 values(值1,值2,值n),(值1,值2,值n),(值1,值2,值n); |
| 示例     | insert into star(name, money, province, age, sex) values('黄晓明', 2,  '山东',  39, 0), ( '杨幂', 3, '北京', 27, 1), ( '陈赫', 5, '福建', 31, 0); |
| 示例说明 | 向user表中插入值id为1，姓名为黄晓明，余额为2，省份为山东，年龄为39，性别为0(男)，姓名为杨幂，余额为3，省份为北京，年龄为27，性别为1(女)，姓名为陈赫，余额为5，省份为福建，年龄为31，性别为0(男) |

##### 修改数据

**注意：where必须要加，否则后果自负**

| **类别** | **详细解释**                                  |
| -------- | --------------------------------------------- |
| 基本语法 | update 表 set 字段1=值1,字段2=值2 where 条件; |
| 示例     | update star set money=100, sex=1 where id=1;  |
| 示例说明 | 将star表中id为1的行的money设为100，sex设为1   |

| 类型     | 说明                                                    |
| -------- | ------------------------------------------------------- |
| 基本语法 | update 表名 set 字段1=值1, …, 字段n=值n where 条件      |
| 示例     | update money set balance=balance-500 where userid = 15; |
| 示例说明 | 修改money表，将balance余额减500。要求userid为15         |

##### 删除数据

**注意：where必须要加，否则后果自负。**

**注意：delete删除表中的所有数据，自增的id会继续从原有的值增加。**

| **类别** | **详细解释**                 |
| -------- | ---------------------------- |
| 基本语法 | delete from 表 where 条件;   |
| 示例     | delete from star where id=5; |
| 示例说明 | 删除表star中id为5的行        |

##### 清空数据

| 类别     | 详细解释                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | truncate 表名；                                              |
| 示例     | truncate  test;                                              |
| 示例说明 | 清空test表中所有的数据，保留表字段和表结构，并且让自增的id从1开始自增。 |

### 多表操作

##### 多表联合查询

很多时候在实际的业务中我们不只是查询一张表。

如：在电子商务系统中，查询哪些商品没有用户购买。

​		银行中可以查询违规记录，同时查询出用户的基本信息

​		查询中奖信息，同时查询中奖人员的基本信息。

而上述业务中需要多表联合在一起查询，其本质就是表连接。

##### 查询分类

内连接：选出两个表中存在连接关系的字段符合连接关系的那些记录。

外连接：会选出其他不匹配的记录，分为外左连接和外右连接。

##### 内连接隐式

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | select 表1.字段 [as 别名], 表n.字段 from 表1 [别名], 表n where 条件; |
| 示例     | select username,  name from user, goods where user.gid=goods.gid; |
| 示例说明 | 查询用户表中哪些用户购买过商品，并将商品信息显示出来         |

说明：以上方式称为隐式内连接，因为没有出现join关键字

##### 内连接显式

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | select 表1.字段 ,表2.字段 from 表1 inner join 表2 on 条件;   |
| 示例     | select * from tableA inner join tableB on tableA.name = tableB.name |
| 示例说明 | 显示A、B表中共有的数据                                       |

![img](https://images2015.cnblogs.com/blog/942964/201611/942964-20161114210753217-631727288.png)

##### 外连接之全连接

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | select 表1.字段 ,表2.字段 from 表1 full join 表2 on 条件;    |
| 示例     | select * from tableA full join tableB on tableA.name = TableB.name; |
| 示例说明 | 显示A表和B表所有的数据                                       |

![img](https://images2015.cnblogs.com/blog/942964/201611/942964-20161114210844045-1024455852.png)

full  join结合where 表.字段 is null ，可以取得只有在A、B中的数据集

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | select 表1.字段 , 表2.字段 from 表1 left join 表2 on 条件 where 表.字段 is null; |
| 示例     | select * from tableA full join tableB on tableA.name = tableB.name where tableA.id is null or tableB.id is null |
| 示例说明 | 显示只有在A、B表中存在的数据集                               |

![img](https://images2015.cnblogs.com/blog/942964/201611/942964-20161114224217357-976604114.png)

##### 外连接之左连接

左连接：包含所有的左边表中的记录甚至是右边表中没有和它匹配的记录

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | select 表1.字段 , 表2.字段 from 表1 left join 表2 on 条件;   |
| 示例     | sselect * from tableA left join tableB on tableA.name = tableB.name |
| 示例说明 | 以左边为主，显示A表的全部数据                                |

![img](https://images2015.cnblogs.com/blog/942964/201611/942964-20161114224320607-811530394.png)

left  join结合where 表.字段 is null ，可以取得只有在A中的数据集

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | select 表1.字段 , 表2.字段 from 表1 left join 表2 on 条件 where 表.字段 is null; |
| 示例     | select * from tableA left  join tableB on tableA.name = tableB.name where tableB.id is null |
| 示例说明 | 以左边为主，显示只有在A表中才存在的数据                      |

![img](https://images2015.cnblogs.com/blog/942964/201611/942964-20161114224344513-2140434697.png)

##### 外连接之右连接

右连接：包含所有的右边表中的记录甚至是左边表中没有和它匹配的记录

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | select 表1.字段 , 表2.字段 from 表1 right join 表2 on 条件;  |
| 示例     | select * from user right join goods on user.gid = goods.gid; |
| 示例说明 | 以右边为主，查询哪些商品有用户购买，并将用户信息显示出来     |

##### 子(嵌套)查询

| **类型** | **说明**                                                 |
| -------- | -------------------------------------------------------- |
| 示例     | select * from user where gid in (select gid from goods); |
| 示例说明 | 将购买过商品的用户信息显示出来                           |

##### 记录联合

关键字 union 、union all，将两个表的数据按照一定的查询条件查询出来后，将结果合并到一起显示。

两者主要的区别是， union 将 union all 后的结果进行一次distinct，去除重复记录后的结果。

| **类型** | **说明**                                     |
| -------- | -------------------------------------------- |
| 基本语法 | select 语句1 union[all] select 语句2         |
| 示例     | 左连接 union 右连接;                         |
| 示例说明 | 将商品表中的信息和用户表中的信息的组合在一起 |

##### 同时更新

| **类型** | **说明**                                                     |
| -------- | ------------------------------------------------------------ |
| 基本语法 | update 表1,表2 set 字段1=值1, …, 字段n=值n where 条件        |
| 示例     | update user u, goods g set u.gid=0, g.price=1799 where u.id=8 and u.gid=g.gid; |
| 示例说明 | user表的别名设置为u，将goods表的别名设置为g；将u表的gid改为0，g表的price改为1799。执行条件是：u.id = 8并且gid相等 |

### 主从配置

##### 部署环境 

主(master_mysql): 192.168.1.200 OS:CentOS 6.5  

从(slave_mysql): 192.168.1.201 OS:CentOS 6.5 

##### 安装mysql 

主和从都安装

``` 
yum install mysql-server
```

##### 主库配置

修改配置文件

```
vim etcmy.cnf

server-id=200	# 设置主服务器的ID

innodb_flush_log_at_trx_commit=2  #系统崩溃或断电的情况下，上⼀秒钟所有事务数据才可能丢失

sync_binlog=1	# 开启binlog⽇志同步功能

log-bin=mysql-bin-200	# binlog⽇志⽂件名

binlog-do-db=xxxx	# 表示只同步某个库（若没有此项，表示同步所有的库）
```

重启主库的MySQL

```
service mysqld restart

# 登录MySQL
mysql -u root -p	

# 授权从数据库服务器192.168.1.201，⽤户名mark，密码123456
mysql>grant replication slave on . to 'mark'@'192.168.1.201' identified by '123456';

# 查看主库的状态 
mysql>show master status;
# 这里要记录File、Position的值
```

##### 从库配置

修改配置文件

```
vim etcmy.cnf

server-id=201

innodb_flush_log_at_trx_commit=2

sync_binlog=1

log-bin=mysql-bin-201
```

 重启从库的MySQL

```
# 登录MySQL
mysql -u root -p

# 设置主库服务器192.168.1.200，⽤户名mark，密码123456，master_log_file、master_log_pos就是上面查看主库状态记录的File、Position的值
mysql> change master to master_host='192.168.1.200',master_user='mark' ,master_password='123456', master_log_file='mysqlbin-200.000002',master_log_pos=1167;

# 开启从库 (stop slave：关闭从库)
mysql> start slave; 

# 查看从库状态
mysql> show slave status; 
# 当Slave_IO_Running,Slave_SQL_Running 都为Yes的时候表示配置成功
```

##### 验证主从

在主库上创建⼀个库，再在从库上刷新查看是否同步。
