# 文本处理、时间日期、数值

与其他大多数计算机语言一样，SQL支持利用函数来处理数据。函数一般是在数据上执行的，它给数据的转换和处理提供了方便。

!> 能运行在多个系统上的代码称为可移植的（portable）。相对于SQL来说，函数可移植性差些，如果你决定使用函数，应该保证做好代码注释，以便以后你（或其他人）能确切地知道所编写SQL代码的含义。

### 文本处理函数

##### Trim函数

`Trim()函数`：**去掉字符串左右两边的空格。**

`RTrim()函数`：**去掉字符串右边的空格。**

`LTrim()函数`：**去掉字符串左边的空格。**

```sql
-- 去掉字符串左右两边的空格再输出
SELECT Trim(字段) FROM 表名;
```

##### Upper函数

`Upper()函数`：**文本转换为大写再输出。**

```sql
-- 将文本转换为大写再输出
SELECT Upper(字段) FROM 表名;
```

##### Lower函数

`Lower()函数`：**文本转换为小写再输出。**

```sql
-- 将文本转换为小写再输出
SELECT Lower(字段) FROM 表名;
```

##### 常用文本函数

|     函 数     |       说 明       |
| :-----------: | :---------------: |
|  `Length()`   |   返回串的长度    |
|  `Locate()`   | 找出串的一个子串  |
|   `Left()`    | 返回串左边的字符  |
|   `Right()`   | 返回串右边的字符  |
| `SubString()` |  返回子串的字符   |
|  `Soundex()`  | 返回串的SOUNDEX值 |

这里的SOUNDEX需要做进一步的解释：**SOUNDEX是一个将任何文本串转换为描述其语音表示的字母数字模式的算法，考虑了类似的发音字符和音节，使得能对串进行发音比较而不是字母比较。**

```sql
-- 表中有一个顾客其联系名为Y.Lee。但如果这是输入错误，此联系名实际应该是Y.Lie，怎么办？
SELECT * FROM 表名 WHERE 字段='Y.Lie';
/*
0 rows in set (0.00 sec)
*/
-- 显然，按正确的联系名搜索不会返回数据。
-- 现在试一下使用Soundex()函数进行搜索，它匹配所有发音类似于Y.Lie的联系名。
SELECT * FROM 表名 WHERE Soundex(字段)=Soundex('Y.Lie');
/*
+-------------+
|    字段      |
+-------------+
|    Y.Lee    |
+-------------+
1 rows in set (0.00 sec)
*/
```

### 日期时间处理函数

**日期和时间采用相应的数据类型和特殊的格式存储，以便能快速和有效地排序或过滤，并且节省物理存储空间。**

##### 常用日期时间函数

|      函 数      |             说 明              |
| :-------------: | :----------------------------: |
|   `AddDate()`   |    增加一个日期（天、周等）    |
|   `AddTime()`   |    增加一个时间（时、分等）    |
|   `CurDate()`   |          返回当前日期          |
|   `CurTime()`   |          返回当前时间          |
|    `Date()`     |     返回日期时间的日期部分     |
|  `DateDiff()`   |        计算两个日期之差        |
|  `Date_Add()`   |     高度灵活的日期运算函数     |
| `Date_Format()` |  返回一个格式化的日期或时间串  |
|    `Day() `     |     返回一个日期的天数部分     |
|  `DayOfWeek()`  | 对于一个日期，返回对应的星期几 |
|    `Hour()`     |     返回一个时间的小时部分     |
|   `Minute()`    |     返回一个时间的分钟部分     |
|    `Month()`    |     返回一个日期的月份部分     |
|     `Now()`     |       返回当前日期和时间       |
|   `Second()`    |      返回一个时间的秒部分      |
|    `Time()`     |   返回一个日期时间的时间部分   |
|    `Year()`     |     返回一个日期的年份部分     |

##### 日期筛选

之前我们都是用比较数值和文本的WHERE子句过滤数据，但数据经常需要用日期进行过滤。

!> MySQL使用的日期格式。无论你什么时候指定一个日期，日期必须为格式yyyy-mm-dd，因为它排除了多义性。例如：2005年9月1日，给出为2005-09-01。

```sql
-- 筛选日期为2005年9月1日的所有行
SELECT * FROM 表名 WHERE 日期字段='2005-09-01';
```

但是还有一种情况，假如日期存储的数据类型为datetime，即日期全都有时间值`00:00:00`，如果只匹配日期 `2005-09-01` ，则不会把它检索出来，匹配失败。

解决办法是：**使用 `Date()` 函数，仅提取列的日期部分进行比较，而不是将给出的日期与整个列值进行比较。**

```sql
-- 筛选日期为2005年9月1日的所有行
SELECT * FROM 表名 WHERE Date(日期字段)='2005-09-01';
```

##### 日期范围

检索出2005年9月下的所有行，有几种解决办法：

```sql
-- 筛选日期范围在2005年9月1号至2005年9月30号之间的所有行
SELECT * FROM 表名 WHERE Date(日期字段) BETWEEN '2005-09-01' AND '2005-09-30';

-- 筛选日期范围在2005年9月的所有行
SELECT * FROM 表名 WHERE Year(日期字段)='2005' AND Month(日期字段)='9';
```

### 数值处理函数

数值处理函数仅处理数值数据。这些函数一般主要用于代数、三角或几何运算，因此没有串或日期—时间处理函数的使用那么频繁。在主要DBMS的函数中，数值函数是最一致最统一的函数。

##### 常用数值处理函数

|  函 数   |       说 明        |
| :------: | :----------------: |
| `Abs()`  | 返回一个数的绝对值 |
| `Cos()`  | 返回一个角度的余弦 |
| `Exp()`  | 返回一个数的指数值 |
| `Mod()`  |  返回除操作的余数  |
|  `Pi()`  |     返回圆周率     |
| `Rand()` |   返回一个随机数   |
| `Sin()`  | 返回一个角度的正弦 |
| `Sqrt()` | 返回一个数的平方根 |
| `Tan()`  | 返回一个角度的正切 |











