# 模糊查询、正则表达式

### 模糊查询

前面介绍的所有操作符都是针对已知值进行过滤的。但是，这种过滤方法并不是任何时候都好用。例如，怎样搜索字符串中包含'jet'的所有字符串？用简单的比较操作符肯定不行，必须使用通配符。

##### 通配符

通配符(wildcard)：**结合 `LIKE` 操作符来匹配值的一部分的特殊字符**。

搜索模式(search pattern)：**由字面值、通配符或两者组合构成的搜索条件。**

##### 百分号`%`通配符

百分号`%`：**匹配出现任意次数的任意字符（NULL除外）。**

```sql
-- 检索任意以jet起头的字符串，不管后面是什么字符和有多少字符
SELECT * FROM 表名 WHERE 字段名 LIKE 'jet%';

-- 检索任意位置包含jet的字符串，而不论它之前或之后出现什么字符。
SELECT * FROM 表名 WHERE 字段名 LIKE '%jet%';

-- 检索以j起头，以t结尾的字符串，而不论中间出现什么字符。
SELECT * FROM 表名 WHERE 字段名 LIKE 'j%t';
```

!> MySQL检索可以选择区分大小写的。如果区分，`jet%` 与 `Jet...` 将不匹配。

!> 百分号(%)除了匹配一个或多个字符外，还能匹配0个字符。

!> 字符串尾空格可能会干扰通配符匹配，检索时最好在最后附加一个百分号(%)。

##### 下划线`_`通配符

下划线`_`：**匹配出现任意的单个字符。**

```sql
-- 检索任意以jet起头，长度为4的所有行
SELECT * FROM 表名 WHERE 字段名 LIKE 'jet_';

-- 检索任意以jet结尾，长度为4的所有行
SELECT * FROM 表名 WHERE 字段名 LIKE '_jet';

-- 检索第一个、最后一个字符为任意字符，中间字符为jet，长度为5的所有行
SELECT * FROM 表名 WHERE 字段名 LIKE '_jet_';
```

!> 下划线(_)必须要匹配到一个字符，不能多也不能少。

##### 使用技巧

通配符很有用，但通配符搜索的处理一般要比前面讨论的其他搜索所花时间更长。这里给出一些使用通配符要记住的技巧：

1. **不要过度使用通配符。**如果其他操作符能达到相同的目的，应该使用其他操作符。
2. **通配符不要用在搜索模式的开始处。**除非绝对有必要，否则搜索起来是最慢的。
3. **注意通配符的位置。**如果放错地方，可能不会返回想要的数据。

### 正则表达式

> 所有种类的程序设计语言、文本编辑器、操作系统等都支持正则表达式。

用匹配、比较和通配操作符寻找数据，对于基本的过滤，基本就足够了。但随着过滤条件的复杂性的增加，`WHERE` 子句本身的复杂性也增加。这也就是正则表达式变得有用的地方。

##### 基本字符匹配

REGEXP：**正则表达式关键字，后面跟正则表达式。**

```sql
-- 检索字段中包含jet的所有行
SELECT * FROM 表名 WHERE 字段名 REGEXP 'jet';

-- 检索任意以jet起头，长度为4的所有行
SELECT * FROM 表名 WHERE 字段名 REGEXP 'jet.';
```

!> `LIKE 'jet'` 匹配列值中等于 `jet` 所有行，`REGEXP 'jet'` 匹配列值中包含 `jet` 的所有行。

?> MySQL中的正则表达式匹配（自版本3.23.4后）不区分大小写）。需要区分大小写，可使用 `BINARY` 关键字，如 `WHERE 字段名 REGEXP BINARY '正则表达式'`。

##### 或`|`匹配

或`|`：**使用一个或者另一个正则表达式去匹配字符串。**

```sql
-- 检索字段中包含jet或cat或cat的所有行
SELECT * FROM 表名 WHERE 字段名 REGEXP 'jet|cat|hat';
```

##### 单`[]`匹配

单`[]`：**匹配出现在 `[]` 中的任意单个字符。**

```sql
-- 检索字段中包含hao1或hao2或hao3的所有行
SELECT * FROM 表名 WHERE 字段名 REGEXP 'hao[123]';
```

**结合或 `|` 匹配，还可以匹配字符串**：

```sql
-- 检索字段中包含hao1或hao23的所有行
SELECT * FROM 表名 WHERE 字段名 REGEXP 'hao[1|23]';
```

**结合非 `^` 匹配，还可以匹配不在 `[]` 中的任意单个字符：**

```sql
-- 检索字段中包含hao但除开hao1或hao2或hao3外的所有行
SELECT * FROM 表名 WHERE 字段名 REGEXP 'hao[^123]';
```

**在 `[]` 内匹配范围，简化集合，可使用 `-` 来定义一个范围：**

```
匹配任意数字字符：[0-9]，即[0123456789]
匹配任意字母字符：[a-z]
```

